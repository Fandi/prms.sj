<!DOCTYPE html>
<html>
<head>
	<title>Test</title>
	<script type="text/javascript" src="prms.js"></script>
	<script type="text/javascript">
		function test(callback, delay, value) {
			var xhr = new XMLHttpRequest();
			xhr.open('GET', 'Delay.ashx?delay=' + delay + '&value=' + value, true);

			xhr.onreadystatechange = function () {
				if (xhr.readyState === XMLHttpRequest.DONE)
					try {
						callback(eval(xhr.responseText));
					} catch (e) {
						callback(xhr.responseText);
					}
			};

			xhr.send();
		};

		function writeln(value) {
			document.body.appendChild(document.createTextNode(value || ''));
			document.body.appendChild(document.createElement('BR'));
		};

		function getFirstWord(cb) {
			// supposedly reads dictionary asynchronously
			cb('It');
		};

		function getSecondWord(cb) {
			// supposedly reads another dictionary asynchronously
			cb('Works!');
		};

		window.addEventListener('load', function () {
			var word1 = async(getFirstWord);
			var word2 = async(getSecondWord);

			async(function (cb) {
				var h1 = document.createElement('H1');
				h1.appendChild(document.createTextNode(word1.value + ' ' + word2.value + ' Cihuy!'));
				document.body.appendChild(h1);

				cb();
			});

			revoke();
		});
	</script>
</head>
<body>
</body>
</html>
